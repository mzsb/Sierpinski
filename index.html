<head>
	<link rel="icon" type="image/x-icon" href="favicon.png">
</head>
<body style="background: #000000; margin: 0; padding: 0; border: 0;">
	<canvas id="canv"></canvas>
</body>
<script>
   document.title = "Sierpinski";
	console.log("Mathematical simulation by Barnabás Mózs. https://github.com/mzsb/sierpinski");
	const canvas = document.getElementById('canv');
	const context = canvas.getContext('2d');

	//init variables
	var maxWidth;
	var maxHeight;
	var radius;
	var x;
	var y;

	//sierpinski variables
	var values = [/* purple: vertices, green: scale, orange: pixel */];
	var polygon = [];
	var angle;
	var randomX;
	var randomY;
	var randomVertex = [];

	function init() {
		maxWidth = window.innerWidth - 3;
		maxHeight = window.innerHeight - 1;
		canvas.width = maxWidth;
		canvas.height = maxHeight;
		x = maxWidth / 2;
		y = maxHeight / 2;
		radius = (x > y ? y : x);

		sierpinski(x, y, radius);
	}

	function sierpinski(x, y, radius) {
		polygon[0] = [0, -radius * (1 - 1 / values[1])];
		for (j = 1; j < values[0]; j++) {
			angle = j * 6.28318530718 / values[0];
			polygon[j] = [
				(polygon[0][0] * Math.cos(angle)) - (polygon[0][1] * Math.sin(angle)) + x,
				(polygon[0][0] * Math.sin(angle)) + (polygon[0][1] * Math.cos(angle)) + y
			];
		}
		polygon[0] = [polygon[0][0] + x, polygon[0][1] + y];

		randomX = x;
		randomY = y;
		context.clearRect(0, 0, canvas.width, canvas.height);
		for (n = 0; n < 50000 / values[2]; n++) {
			randomVertex = polygon[Math.floor(Math.random() * values[0])];

			randomX = ((randomVertex[0] * values[1] - x) + randomX) / values[1];
			randomY = ((randomVertex[1] * values[1] - y) + randomY) / values[1];

			context.fillStyle = `#${Math.floor(Math.random()*16777215).toString(16)}`;

			context.fillRect(randomX, randomY, values[2], values[2]);
		}
	}

	init();

	function reportWindowSize() {
		init();
	}
	
	const sleep = ms => new Promise(resolve => setTimeout(resolve, ms));


	const randInt = (min, max) => Math.floor(Math.random() * (max - min) ) + min;


	window.addEventListener('load', async function () {


		const datas = [[0,3,10], [1,2,6], [2,3,6]]

		const rands = []

		datas.forEach(element => {
			rands.push(element[2] / 2)

			element.push(element[2] / 2)
		});

		do {
			for await (const data of datas) {
		
				var d = Math.floor(Math.random() * 2) % 2 === 0 ? 1 : -1

				rands[data[0]] = randInt(data[3], d > 0 ? data[2] : data[1])

				
				while(Math.abs(data[3] - rands[data[0]]) >= 0.1) {
					
					await sleep(0)

					data[3] += 0.08 * d

					values[data[0]] = data[3];

					sierpinski(x, y, radius)
				}
			}


		} while(true)
	})


	window.onresize = reportWindowSize;

</script>

<style>
	body,html {
		overflow: hidden;
	}
	@keyframes rotation {
	from {
		transform: rotate(0deg);
	}
	to {
		transform: rotate(359deg);
	}
	}

	#canv {
		transform: scale(0.9);
		border: 0px;
		height: 100%;
		width: 100%;
		background: #000000;
		animation: rotation 42s infinite linear;
	}

	#vertice-slider {
		transform: rotate(30deg);
	}

	#scale-slider {
		transform: rotate(150deg);
	}

	#pixel-slider {
		transform: rotate(-90deg);
	}

	#vertice-slider::-webkit-slider-thumb {
		background: purple;
	}

	#scale-slider::-webkit-slider-thumb {
		background: green;
	}

	#pixel-slider::-webkit-slider-thumb {
		background: orange;
	}

	.slider {
		position: absolute;
		-webkit-appearance: none;
		height: 0;
		border-radius: 5px;
		background: transparent;
		cursor: pointer;
		margin: 0 0 0 2;
	}

	.slider::-webkit-slider-thumb {
		-webkit-appearance: none;
		appearance: none;
		width: 1.7vmin;
		height: 1.7vmin;
		opacity: 0.7;
		border-radius: 100%;
		cursor: pointer;
	}

</style>