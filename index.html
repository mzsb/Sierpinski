<head>
	<link rel="icon" type="image/x-icon" href="favicon.png">
</head>
<body style="background: #000000; margin: 0; padding: 0; border: 0; display: flex;">
	<canvas id="canv"></canvas>
	<input type="range" min="2" max="12" value="3" step="0.001" id="vertice-slider" class="slider">
	<input type="range" min="1" max="11" value="2" step="0.001" id="scale-slider" class="slider">
	<input type="range" min="0.7" max="10.7" value="1.7" step="0.001" id="pixel-slider" class="slider">
</body>
<script>
    document.title = "Sierpinski";
	console.log("Mathematical simulation by Barnabás Mózs. https://github.com/mzsb/sierpinski");
	const canvas = document.getElementById('canv');
	const sliders = [
		document.getElementById("vertice-slider"),
		document.getElementById("scale-slider"),
		document.getElementById("pixel-slider")
	];
	const context = canvas.getContext('2d');
	const rawParams = window.location.href?.split("?")[1];
	var params = rawParams?.split("&")?.map(p => p?.split("=")[1]);

	if(!params || params.filter(p => p !== undefined).length < 3) {
		setParams();
	}

	//init variables
	var maxWidth;
	var maxHeight;
	var radius;
	var x;
	var y;

	//sierpinski variables
	var values = [/* purple: vertices, green: scale, orange: pixel */];
	var polygon = [];
	var angle;
	var randomX;
	var randomY;
	var randomVertex = [];

	function init() {
		maxWidth = window.innerWidth - 3;
		maxHeight = window.innerHeight - 1;
		canvas.width = maxWidth;
		canvas.height = maxHeight;
		x = maxWidth / 2;
		y = maxHeight / 2;
		radius = (x > y ? y : x);

		for (i = 0; i < sliders.length; i++) {
			sliders[i].oninput = () => {
				setParams();
				sierpinski(x, y, radius) 
			};
			sliders[i].style.width = 2 * radius;
			sliders[i].style.left = x - radius;
			sliders[i].style.top = y;
			if(parseFloat(params[i]) > parseFloat(sliders[i].max)) {
				sliders[i].max = params[i];
			}
			sliders[i].value = params[i];
		}

		sierpinski(x, y, radius);
	}

	function sierpinski(x, y, radius) {

		for(i = 0; i < sliders.length; i++) {
			values[i] = params[i] > sliders[i].max ? params[i] : sliders[i].value;
		}

		polygon[0] = [0, -radius * (1 - 1 / values[1])];
		for (j = 1; j < values[0]; j++) {
			angle = j * 6.28318530718 / values[0];
			polygon[j] = [
				(polygon[0][0] * Math.cos(angle)) - (polygon[0][1] * Math.sin(angle)) + x,
				(polygon[0][0] * Math.sin(angle)) + (polygon[0][1] * Math.cos(angle)) + y
			];
		}
		polygon[0] = [polygon[0][0] + x, polygon[0][1] + y];

		randomX = x;
		randomY = y;
		context.clearRect(0, 0, canvas.width, canvas.height);
		for (n = 0; n < 50000 / values[2]; n++) {
			randomVertex = polygon[Math.floor(Math.random() * values[0])];

			randomX = ((randomVertex[0] * values[1] - x) + randomX) / values[1];
			randomY = ((randomVertex[1] * values[1] - y) + randomY) / values[1];

			context.fillStyle = `#${Math.floor(Math.random()*16777215).toString(16)}`;

			context.fillRect(randomX, randomY, values[2], values[2]);
		}
	}

	function setParams() {
		history.pushState({}, null, window.location.href?.split("?")[0] + `?purple=${sliders[0].value}&green=${sliders[1].value}&orange=${sliders[2].value}`);
		params = [sliders[0].value, sliders[1].value, sliders[2].value];
	}

	init();

	function reportWindowSize() {
		init();
	}

	window.onresize = reportWindowSize;

</script>

<style>
	#canv {
		border: 0px;
		height: 100%;
		width: 100%;
		background: #000000;
	}

	#vertice-slider {
		transform: rotate(30deg);
	}

	#scale-slider {
		transform: rotate(150deg);
	}

	#pixel-slider {
		transform: rotate(-90deg);
	}

	#vertice-slider::-webkit-slider-thumb {
		background: purple;
	}

	#scale-slider::-webkit-slider-thumb {
		background: green;
	}

	#pixel-slider::-webkit-slider-thumb {
		background: orange;
	}

	.slider {
		position: absolute;
		-webkit-appearance: none;
		height: 0;
		border-radius: 5px;
		background: transparent;
		cursor: pointer;
		margin: 0 0 0 2;
	}

	.slider::-webkit-slider-thumb {
		-webkit-appearance: none;
		appearance: none;
		width: 1.7vmin;
		height: 1.7vmin;
		opacity: 0.7;
		border-radius: 100%;
		cursor: pointer;
	}

</style>